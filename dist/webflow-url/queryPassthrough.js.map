{
  "version": 3,
  "sources": ["../../src/webflow-core/debug.ts", "../../src/webflow-url/queryPassthrough.ts"],
  "sourcesContent": ["\n/*\n * webflow-core\n * \n * Sygnal Technology Group\n * http://sygnal.com\n * \n * Debug Utilities\n */\n\nimport { VERSION } from \"../version\";\n\n\n\nexport class Sa5Debug {\n    \n    private localStorageDebugFlag: string = 'sa5-debug';\n\n    private _enabled: boolean = false;\n    private _label: string;\n\n    // Get or set WFU persistent debug state\n    // which is stored in localStorage. \n    get persistentDebug(): boolean {\n        return Boolean(localStorage.getItem(this.localStorageDebugFlag)); \n    }\n    set persistentDebug(active: boolean) {\n        if (active) {\n            localStorage.setItem(this.localStorageDebugFlag, \"true\");\n            console.debug (`sa5-core debug enabled (persistent).`);\n        } else {\n            localStorage.removeItem(this.localStorageDebugFlag); \n            console.debug (`sa5-core debug disabled (persistent).`);\n        }\n    }\n\n    // Enable/disable debugging \n    get enabled(): boolean {\n\n        // localStorage is checked for a debug flag, to enable remote debug enabling \n        // Any non-null string value will resolve to TRUE here, including the string \"false\" \n        var wfuDebugValue = Boolean(localStorage.getItem(this.localStorageDebugFlag)); \n\n        // Or this with the current debug state\n        // If either is enabled, debugging is on \n        wfuDebugValue = wfuDebugValue || this._enabled; \n\n        return wfuDebugValue;\n    }\n    set enabled(active: boolean) {\n        this._enabled = active;\n    }\n\n\n    // Initialize\n    constructor(label: string) {\n\n        // Save the label, for console logging\n        this._label = label;\n\n    }\n\n\n    // Start a console log group\n    group(name) {\n        if (this.enabled)\n            console.group(name);\n    }\n\n    // End a console log group\n    groupEnd() {\n        if (this.enabled)\n            console.groupEnd();\n    }\n\n    // Log debug data to the console\n    debug(...args: any[]): void {\n\n        if (this.enabled)\n            // Unlimited arguments in a JavaScript function\n            // https://stackoverflow.com/a/6396066\n            console.debug(this._label, ...args); \n            \n    }\n\n    /**\n     * Returns the HTML style string\n     * @param elem The element to return the string for \n     * @returns \n     */\n    static getStyleString(elem: HTMLElement): string {\n\n        let styleString = '';\n    \n        for (let i = 0; i < elem.style.length; i++) {\n            const property = elem.style[i];\n            const value = elem.style.getPropertyValue(property);\n            styleString += `${property}: ${value}; `;\n        }\n    \n        return styleString; \n    }\n\n}\n\n\n", "\n/*\n * SA5 Url | Query Passthrough\n * Carries querystring info to other pages\n * \n * Sygnal Technology Group\n * http://sygnal.com\n * \n * Url Utilities\n */\n\nimport { Sa5Core } from '../webflow-core'\nimport { Sa5Debug } from '../webflow-core/debug';\n\n// CONFIG:\n// Ignore certain links?\n\nexport interface QueryPassthroughConfig {\n    ignorePatterns: (string | RegExp)[];\n    overwriteExisting: boolean; // Overwrite existing params?\n    internalOnly: boolean; // Only affect internal links\n}\n\nexport class Sa5QueryPassthrough {\n\n    debug: Sa5Debug;\n\n    config: QueryPassthroughConfig; // Optional config\n\n    constructor(config: Partial<QueryPassthroughConfig> = {}) {\n\n        this.config = {\n            // Other params to ignore? user accounts login, redir params, etc.\n            // https://www.test.org/pub?b42d817d_page=2\n            ignorePatterns: config.ignorePatterns ?? [\n                /_page$/, // Ignore pagination params\n            ],\n            overwriteExisting: config.overwriteExisting ?? false,\n            internalOnly: config.internalOnly ?? true,\n        }\n\n        // Initialize debugging\n        this.debug = new Sa5Debug(\"sa5-url-querypassthrough\");\n//        this.debug.enabled = true; \n        this.debug.debug (\"Initializing\");\n\n        this.debug.debug (\"Config:\", this.config);\n\n    }\n\n    // Process elements with the custom attr wfu-query-param\n    init() {\n\n        document.addEventListener('click', (event: MouseEvent) => {\n            const target = event.target as HTMLElement;\n            const anchor = target.closest('a');\n\n            this.debug.debug(\"Link clicked\", anchor)\n\n            // No link found\n            if(!anchor)\n                return; // ignore\n\n            // Ignore links with no href \n            if(!anchor.hasAttribute(\"href\")) {\n                this.debug.debug(\"Link ignored - no href\", anchor)\n                return; // ignore\n            }\n\n            // Ignore mailto: and tel: links \n            if(anchor.href.startsWith(\"mailto:\")) {\n                this.debug.debug(\"Link ignored - mailto:\", anchor)\n                return; // ignore\n            }\n                \n            if(anchor.href.startsWith(\"tel:\")) {\n                this.debug.debug(\"Link ignored - tel:\", anchor)\n                return; // ignore \n            }\n\n            // Ignore explicitly ignored links \n            if(anchor.getAttribute(\"wfu-url-passthrough\") == \"ignore\") {\n                this.debug.debug(\"Link click ignored (explicit ignore setting).\")\n                return;\n            }\n\n            const currentPageParams = new URLSearchParams(window.location.search);\n\n            const currentPageHash = window.location.hash; \n\n            // Get the parameters of the anchor URL\n            const anchorParams = new URLSearchParams(anchor.search);\n\n            // Parse the URL and query string\n            const anchorUrl = new URL(anchor.href);\n\n            // Hash handling \n            // If this page\n            if(anchorUrl.hash) {\n                \n                if (anchorUrl.pathname == window.location.pathname) { \n                    this.debug.debug(\"Link click ignored (hash, same page).\")\n                    return;\n                }\n\n            }\n\n// event.preventDefault();\n// return;\n\n            // Check if the URL is relative or if the hostname matches the current hostname\n            if(this.config.internalOnly) {\n                \n                this.debug.debug(\"checking internalOnly\"); \n\n                const isRelativeOrSameHost = !anchorUrl.host || anchorUrl.host === window.location.host;\n\n                if(!isRelativeOrSameHost) {\n\n                    this.debug.debug(\"Found external link, skipping\"); \n                    \n                    return;\n                }\n            }\n\n            // Process link click ourselves\n            // Suppress default handling \n            event.preventDefault();\n\n            this.debug.debug(\"Overriding default link handling.\")\n\n            // Object to hold the new parameters\n//                let newParams: { [key: string]: string } = {};\n\n            // Get existing link params \n            let newParams: URLSearchParams = new URLSearchParams(anchorUrl.searchParams);\n\n            this.debug.debug(newParams)\n\n            /**\n             * Identify the query param keys we want to preserve\n             */\n\n            // Iterate over page parameters\n            for (const [key, value] of currentPageParams) {\n\n                // Ignore specific keys\n                if (this.shouldIgnoreKey(key))\n                    continue; \n\n                // Optionally overwrite anchor params \n                if (anchorParams.has(key) && !this.config.overwriteExisting)\n                    continue; \n                    \n                newParams.set(key, value);\n\n            }\n\n            // Construct the new URL with the modified query string\n//            let newUrl = anchorUrl.origin + anchorUrl.pathname;\n\n            let newUrl: URL = new URL(anchorUrl);\n\n            if(newParams.size > 0) {\n                this.debug.debug(\"Appending querystring params to passthrough\"); \n\n                // Iterate through newParams and set them on the new URL's searchParams\n                newParams.forEach((value, key) => {\n                    newUrl.searchParams.set(key, value); // Overwrite existing parameters by the same name\n                });\n//                newUrl +=  '?' + newParams.toString();\n            }\n\n            // if (anchorUrl.hash) { \n            //     this.debug.debug(\"Appending hash\"); \n            //     newUrl += '#' + anchorUrl.hash; \n            // }\n\n            // Navigate to the new URL\n            this.debug.debug(\"Final URL for navigation\", newUrl.href); \n\n            // Depending on the target, \n            // Open in a new tab, or in the same window \n            if(anchor.target) \n                window.open(newUrl.href, anchor.target);\n            else\n                window.location.href = newUrl.href;\n\n        });\n\n    }\n\n    shouldIgnoreKey(key: string): boolean {\n\n        for (const pattern of this.config.ignorePatterns) {\n            if (typeof pattern === 'string') {\n                if (pattern === key) {\n                    return true;\n                }\n            } else if (pattern instanceof RegExp) {\n                if (pattern.test(key)) {\n                    return true;\n                }\n            }\n        }\n\n        return false;\n    }\n\n}\n"],
  "mappings": "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",
  "names": []
}
